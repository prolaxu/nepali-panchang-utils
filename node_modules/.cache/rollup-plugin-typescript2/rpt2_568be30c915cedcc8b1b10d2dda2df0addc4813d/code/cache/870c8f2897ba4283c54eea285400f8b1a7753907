{"code":"export class MhahSunMoonTimer {\r\n    constructor() {\r\n        this.rad = Math.PI / 180;\r\n        // sun times configuration (angle, morning name, evening name)\r\n        this.times = [\r\n            [-0.833, 'sunRise', 'sunSet'],\r\n            [-0.3, 'sunRiseEnd', 'sunSetStart'],\r\n            [-6, 'dawn', 'dusk'],\r\n            [-12, 'nauticalDawn', 'nauticalDusk'],\r\n            [-18, 'nightEnd', 'night'],\r\n        ];\r\n        this.dayMs = 1000 * 60 * 60 * 24;\r\n        this.J1970 = 2440588;\r\n        this.J2000 = 2451545;\r\n        this.J0 = 0.0009;\r\n        this.e = this.rad * 23.4397; // obliquity of the Earth\r\n    }\r\n    sunTimer(date, lat, lng, height) {\r\n        let calS = this.calculatSunTimer(date, lat, lng, height);\r\n        let result = {\r\n            solarNoon: this.fromJulian(calS.Jnoon),\r\n            nadir: this.fromJulian(calS.Jnoon - 0.5),\r\n        };\r\n        let i, time, h0, Jset, Jrise;\r\n        for (i = 0; i < this.times.length; i += 1) {\r\n            time = this.times[i];\r\n            h0 = (time[0] + calS.dh) * this.rad;\r\n            Jset = this.getSetJ(h0, calS.lw, calS.phi, calS.dec, calS.n, calS.M, calS.L);\r\n            Jrise = calS.Jnoon - (Jset - calS.Jnoon);\r\n            result[time[1]] = this.fromJulian(Jrise);\r\n            result[time[2]] = this.fromJulian(Jset);\r\n        }\r\n        return result;\r\n    }\r\n    calculatSunTimer(date, lat, lng, height) {\r\n        height = height || 0;\r\n        let lw = this.rad * -lng, phi = this.rad * lat, dh = this.observerAngle(height), d = this.toDays(date), n = this.julianCycle(d, lw), ds = this.approxTransit(0, lw, n), M = this.solarMeanAnomaly(ds), L = this.eclipticLongitude(M), dec = this.declination(L, 0), Jnoon = this.solarTransitJ(ds, M, L);\r\n        return { Jnoon, dh, lw, phi, dec, n, M, L };\r\n    }\r\n    getSunRiseJd(date, lat, lng, height) {\r\n        let calS = this.calculatSunTimer(date, lat, lng, height);\r\n        let time, h0, Jset, Jrise;\r\n        time = this.times[0];\r\n        h0 = (time[0] + calS.dh) * this.rad;\r\n        Jset = this.getSetJ(h0, calS.lw, calS.phi, calS.dec, calS.n, calS.M, calS.L);\r\n        Jrise = calS.Jnoon - (Jset - calS.Jnoon);\r\n        return Jrise;\r\n    }\r\n    observerAngle(height) {\r\n        return (-2.076 * Math.sqrt(height)) / 60;\r\n    }\r\n    julianCycle(d, lw) {\r\n        return Math.round(d - this.J0 - lw / (2 * Math.PI));\r\n    }\r\n    toJulian(date) {\r\n        return date.valueOf() / this.dayMs - 0.5 + this.J1970;\r\n    }\r\n    fromJulian(j) {\r\n        return new Date((j + 0.5 - this.J1970) * this.dayMs);\r\n    }\r\n    toDays(date) {\r\n        return this.toJulian(date) - this.J2000;\r\n    }\r\n    approxTransit(Ht, lw, n) {\r\n        return this.J0 + (Ht + lw) / (2 * Math.PI) + n;\r\n    }\r\n    hourAngle(h, phi, d) {\r\n        return Math.acos((Math.sin(h) - Math.sin(phi) * Math.sin(d)) /\r\n            (Math.cos(phi) * Math.cos(d)));\r\n    }\r\n    solarTransitJ(ds, M, L) {\r\n        return this.J2000 + ds + 0.0053 * Math.sin(M) - 0.0069 * Math.sin(2 * L);\r\n    }\r\n    solarMeanAnomaly(d) {\r\n        return this.rad * (357.5291 + 0.98560028 * d);\r\n    }\r\n    eclipticLongitude(M) {\r\n        var C = this.rad *\r\n            (1.9148 * Math.sin(M) +\r\n                0.02 * Math.sin(2 * M) +\r\n                0.0003 * Math.sin(3 * M)), // equation of center\r\n        P = this.rad * 102.9372; // perihelion of the Earth\r\n        return M + C + P + Math.PI;\r\n    }\r\n    declination(l, b) {\r\n        return Math.asin(Math.sin(b) * Math.cos(this.e) +\r\n            Math.cos(b) * Math.sin(this.e) * Math.sin(l));\r\n    }\r\n    getSetJ(h, lw, phi, dec, n, M, L) {\r\n        var w = this.hourAngle(h, phi, dec), a = this.approxTransit(w, lw, n);\r\n        return this.solarTransitJ(a, M, L);\r\n    }\r\n}\r\n//# sourceMappingURL=mhahSunMoonTimer.js.map","references":[],"map":"{\"version\":3,\"file\":\"mhahSunMoonTimer.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/mhahSunMoonTimer.ts\"],\"names\":[],\"mappings\":\"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\"}"}
